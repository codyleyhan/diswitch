(this.webpackJsonpdiswitch=this.webpackJsonpdiswitch||[]).push([[0],{122:function(e,t,n){"use strict";n.r(t);var c,a=n(149),r=n(0),i=n.n(r),s=n(36),o=n.n(s),l=n(53),u=n(14),j=n(153),d=n(67),h=n(137),b=n(148),f=n(151),O=n(66),x=n(54),g=n(103),m=n(133),p=n(83),v=n(3),w=function(e){var t=Object(g.c)().toggleColorMode,n=Object(g.d)("dark","light"),c=Object(g.d)(p.a,p.b);return Object(v.jsx)(m.a,Object(x.a)({size:"md",fontSize:"lg","aria-label":"Switch to ".concat(n," mode"),variant:"ghost",color:"current",marginLeft:"2",onClick:t,icon:Object(v.jsx)(c,{})},e))},S=n(6),y=n(142),C=n(138),k=n(155),W=n(150),E=n(135),I=n(136),T=n(139),D=n(140),P=n(154),z=n(152),R=n(157),L=n(46),N=n.n(L),A=n(75),F=function(e){return"ON"===e.POWER||("OFF"===e.POWER||console.log("UNKNOWN RESPONSE FROM SWITCH: ",e),!1)},U=function(){var e=Object(A.a)(N.a.mark((function e(t){var n,c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(t,"/cm?cmnd=Power"));case 2:return n=e.sent,e.next=5,n.json();case 5:return c=e.sent,e.abrupt("return",F(c));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),H=function(){var e=Object(A.a)(N.a.mark((function e(t){var n,c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(t,"/cm?cmnd=Power%20TOGGLE"));case 2:return n=e.sent,e.next=5,n.json();case 5:return c=e.sent,e.abrupt("return",F(c));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=Object(A.a)(N.a.mark((function e(t){var n,c;return N.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(t,"/cm?cmnd=State"));case 2:return n=e.sent,e.next=5,n.json();case 5:return c=e.sent,e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(e){var t=Object(O.b)(),n=Object(W.a)(),c=["switches",e.hostname],a=Object(z.a)(c,(function(){return U(e.hostname)}),{refetchInterval:15e3}),r=a.isLoading,i=a.error,s=a.data,o=Object(R.a)((function(){return H(e.hostname)}),{onSuccess:function(e,n,a){t.setQueryData(c,e)},onError:function(e,t,c){n({title:"failed to toggle switch",description:"failed because: "+e,status:"error",duration:5e3,isClosable:!0})}});return Object(v.jsx)(E.a,{children:Object(v.jsxs)(I.a,{children:[Object(v.jsx)(h.a,{p:2,children:Object(v.jsx)(E.b,{href:"/switches/"+e.id,children:Object(v.jsx)(C.a,{size:"md",children:e.name})})}),Object(v.jsx)(T.a,{}),Object(v.jsxs)(h.a,{children:[r?Object(v.jsx)(D.a,{colorScheme:"orange",mr:3,children:"fetching status"}):null,i&&!r?Object(v.jsx)(D.a,{colorScheme:"orange",mr:3,children:"unknown status"}):null,Object(v.jsx)(P.a,{isDisabled:r||i||o.isLoading,colorScheme:"green",size:"lg",isChecked:s||!1,onChange:function(e){return o.mutate()}})]})]})})},q=n(21),B=Object(r.createContext)(),Q="switches",_=JSON.parse(localStorage.getItem(Q))||[],G="ADD_SWITCH",K="DELETE_SWITCH",$="UPDATE_SWITCH",V=(c=function(e,t){switch(t.type){case G:return t.payload.id=0===e.length?0:e[e.length-1].id+1,[].concat(Object(q.a)(e),[t.payload]);case K:return e.filter((function(e){return e.id!==t.payload}));case $:return e.map((function(e){return e.id!==t.payload.id?e:Object(x.a)(Object(x.a)({},e),t.payload)}));default:throw new Error(t.type+" is an invalid action type")}},function(e,t){var n=c(e,t);return localStorage.setItem(Q,JSON.stringify(n)),n}),X=function(e){var t=Object(r.useReducer)(V,_),n=Object(S.a)(t,2),c=n[0],a=n[1];return Object(v.jsx)(B.Provider,{value:[c,a],children:e.children})},Y=function(e){var t=i.a.useContext(B),n=Object(S.a)(t,2),c=n[0],a=(n[1],c.map((function(e){return Object(v.jsx)(M,{name:e.name,hostname:e.hostname,id:e.id},e.id)})));return Object(v.jsxs)(y.a,{children:[Object(v.jsx)(C.a,{children:"switches"}),Object(v.jsx)(k.b,{align:"stretch",divider:Object(v.jsx)(k.a,{}),children:a})]})},Z=n(49),ee=n(143),te=n(156),ne=n(102),ce=n(144),ae=function(e){var t=i.a.useContext(B),n=Object(S.a)(t,2),c=(n[0],n[1]),a=i.a.useState(""),r=Object(S.a)(a,2),s=r[0],o=r[1],l=i.a.useState(""),u=Object(S.a)(l,2),j=u[0],d=u[1],b=Object(W.a)(),f=""!==j&&!j.startsWith("http");return Object(v.jsx)(I.a,{width:"full",align:"center",justifyContent:"center",children:Object(v.jsxs)(h.a,{p:2,children:[Object(v.jsx)(h.a,{textAlign:"center",children:Object(v.jsx)(C.a,{children:"create new switch"})}),Object(v.jsx)(h.a,{my:4,textAlign:"left",children:Object(v.jsxs)("form",{onSubmit:function(e){e.preventDefault(),c({type:G,payload:{name:s,hostname:j}}),o(""),d(""),b({title:s+" added!",description:"Successfully added switch "+s+" at "+j,status:"success",duration:5e3,isClosable:!0})},children:[Object(v.jsxs)(Z.a,{isRequired:!0,children:[Object(v.jsx)(ee.a,{children:"name"}),Object(v.jsx)(te.a,{placeholder:"switch nickname",size:"md",variant:"flushed",value:s,isRequired:!0,onChange:function(e){return o(e.target.value)}})]}),Object(v.jsxs)(Z.a,{mt:6,isRequired:!0,children:[Object(v.jsx)(ee.a,{children:"hostname"}),Object(v.jsx)(te.a,{placeholder:"http://my-switch.local",size:"md",variant:"flushed",value:j,isInvalid:f,onChange:function(e){return d(e.target.value)}})]}),Object(v.jsx)(ne.a,{leftIcon:Object(v.jsx)(ce.a,{}),colorScheme:"blue",width:"full",mt:4,isDisabled:""===s||""===j||f,type:"submit"})]})})]})})},re=function(e){return Object(v.jsx)(ae,{})},ie=n(145),se=n(146),oe=function(e){var t=i.a.useContext(B),n=Object(S.a)(t,2),c=n[0],a=n[1],r=c[Object(u.g)().id],s=Object(u.f)(),o=Object(O.b)(),l=Object(W.a)(),j=Object(z.a)(["switches",r.hostname,"state"],(function(){return J(r.hostname)}),{refetchInterval:15e3}),d=j.isLoading,b=j.error,f=j.data,x=j.dataUpdatedAt,g=Object(R.a)((function(){return H(r.hostname)}),{onSuccess:function(e,t,n){o.setQueryData(["switches",r.hostname],e),o.invalidateQueries(["switches",r.hostname,"state"])},onError:function(e,t,n){l({title:"failed to toggle switch",description:"failed because: "+e,status:"error",duration:5e3,isClosable:!0})}}),p=r.hostname.startsWith("http");return Object(v.jsxs)(y.a,{children:[Object(v.jsx)(C.a,{children:Object(v.jsx)(te.a,{value:r.name,isInvalid:""===r.name,size:"xl",variant:"unstyled",onChange:function(e){""!==e.target.value&&(console.log("updating"),a({type:$,payload:{id:r.id,name:e.target.value}}))}})}),Object(v.jsxs)(k.b,{align:"stretch",mt:5,divider:Object(v.jsx)(T.a,{}),children:[Object(v.jsx)(I.a,{children:Object(v.jsx)(h.a,{children:Object(v.jsx)(te.a,{size:"lg",isInvalid:!p,variant:"unstyled",value:r.hostname,onChange:function(e){""!==e.target.value&&e.target.value.startsWith("http")&&(console.log("updating"),a({type:$,payload:{id:r.id,hostname:e.target.value}}))}})})}),d||b?null:Object(v.jsx)(I.a,{children:Object(v.jsxs)(ie.a,{children:["device time on last update: ",f.Time]})}),!d&&!b&&f.Wifi&&f.Wifi.SSId?Object(v.jsx)(I.a,{children:Object(v.jsxs)(ie.a,{children:["device wifi: ",f.Wifi.SSId]})}):null,!d&&!b&&f.Wifi&&f.Wifi.Signal?Object(v.jsx)(I.a,{children:Object(v.jsxs)(ie.a,{children:["wifi signal: ",f.Wifi.Signal]})}):null,Object(v.jsx)(I.a,{children:Object(v.jsxs)(ie.a,{children:["last fetch at: ",new Date(x).toUTCString()]})}),d||b?Object(v.jsxs)(I.a,{children:[d?Object(v.jsx)(D.a,{colorScheme:"orange",mr:3,children:"fetching status"}):null,b&&!d?Object(v.jsx)(D.a,{colorScheme:"orange",mr:3,children:"unknown status"}):null]}):null,Object(v.jsx)(I.a,{children:Object(v.jsx)(P.a,{isDisabled:d||b,colorScheme:"green",size:"lg",isChecked:f&&"ON"===f.POWER||!1,onChange:function(e){return g.mutate()}})}),Object(v.jsx)(I.a,{children:Object(v.jsx)(m.a,{icon:Object(v.jsx)(se.a,{}),colorScheme:"red",onClick:function(){a({type:K,payload:r.id}),s.push("/")}})})]})]})},le=n(147),ue=Object(u.h)((function(e){console.log(e);var t="/"===e.location.pathname?"/create":"/",n="/"===e.location.pathname?Object(v.jsx)(ce.a,{}):Object(v.jsx)(le.a,{});return Object(v.jsx)(h.a,{alignSelf:"flex-end",justifySelf:"flex-end",children:Object(v.jsx)(l.b,{to:t,children:Object(v.jsx)(m.a,{variant:"ghost",isRound:!0,icon:n,size:"lg"})})})})),je=new f.a;var de=function(){return Object(v.jsx)(l.a,{children:Object(v.jsx)(O.a,{client:je,children:Object(v.jsx)(X,{children:Object(v.jsx)(j.a,{theme:d.theme,children:Object(v.jsx)(h.a,{textAlign:"center",fontSize:"xl",children:Object(v.jsxs)(b.a,{minH:"100vh",p:3,children:[Object(v.jsx)(w,{justifySelf:"flex-end"}),Object(v.jsxs)(u.c,{children:[Object(v.jsx)(u.a,{exact:!0,path:"/",children:Object(v.jsx)(Y,{})}),Object(v.jsx)(u.a,{exact:!0,path:"/create",children:Object(v.jsx)(re,{})}),Object(v.jsx)(u.a,{path:"/switches/:id",children:Object(v.jsx)(oe,{})})]}),Object(v.jsx)(ue,{})]})})})})})})},he=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,158)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),r(e),i(e)}))},be=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function fe(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://cra.link/PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}o.a.render(Object(v.jsxs)(r.StrictMode,{children:[Object(v.jsx)(a.a,{initialColorMode:"dark"}),Object(v.jsx)(de,{})]}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");be?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var c=n.headers.get("content-type");404===n.status||null!=c&&-1===c.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):fe(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://cra.link/PWA")}))):fe(t,e)}))}}(),he(console.log)}},[[122,1,2]]]);
//# sourceMappingURL=main.e7a85c04.chunk.js.map